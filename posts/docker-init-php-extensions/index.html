<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Docker环境初始化及安装php扩展 | chuchu-z</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Docker">
    <meta name="description" content="Docker环境初始化及安装php扩展">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker环境初始化及安装php扩展">
<meta property="og:url" content="http://chuchu-z.com/posts/docker-init-php-extensions/">
<meta property="og:site_name" content="chuchu-z">
<meta property="og:description" content="Docker环境初始化及安装php扩展">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-12-30T06:53:42.000Z">
<meta property="article:modified_time" content="2023-05-17T01:52:45.710Z">
<meta property="article:author" content="chuchu-z">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="chuchu-z" href="/atom.xml">
    
    <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/33407400?s=400&u=a9cabf4402e2e3a38e67aa43da21164bbdd22f00&v=4">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 6.0.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://avatars.githubusercontent.com/u/33407400?s=400&u=a9cabf4402e2e3a38e67aa43da21164bbdd22f00&v=4">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">chuchu-z</h5>
          <p class="description">借君三十年，繁花万里好江山</p>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/chuchu-z" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Docker环境初始化及安装php扩展</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale" style="padding-left: 5%;">
        <h1 class="title">Docker环境初始化及安装php扩展</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-12-30T06:53:42.000Z" itemprop="datePublished" class="page-time">
  2021-12-30
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/docker/">Docker</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%8A%E5%AE%89%E8%A3%85php%E6%89%A9%E5%B1%95"><span class="post-toc-text">Docker环境初始化及安装php扩展</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker-%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99"><span class="post-toc-text">Docker 启动报错</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BB%A5%E5%BE%80%E5%AE%89%E8%A3%85%E6%97%B6%E6%89%A7%E8%A1%8C%E8%BF%87%E7%9A%84%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83"><span class="post-toc-text">以往安装时执行过的命令参考</span></a></li></ol>
        </nav>
    </aside>


<article id="post-docker-init-php-extensions"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Docker环境初始化及安装php扩展</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-12-30 14:53:42" datetime="2021-12-30T06:53:42.000Z"  itemprop="datePublished">2021-12-30</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/docker/">Docker</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="Docker环境初始化及安装php扩展"><a href="#Docker环境初始化及安装php扩展" class="headerlink" title="Docker环境初始化及安装php扩展"></a>Docker环境初始化及安装php扩展</h3><span id="more"></span>

<pre class="language-bash" data-language="bash"><code class="language-bash">yum -y <span class="token function">install</span> <span class="token function">vim</span>
<span class="token function">vim</span> /root/.bashrc

<span class="token comment"># 设置alias</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">e</span><span class="token operator">=</span><span class="token string">'exit'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">www</span><span class="token operator">=</span><span class="token string">'cd /home/www/task_server'</span>

<span class="token comment"># 写入设置utf8编码,否则乱码,设置好后先保存退出,并执行source /root/.bashrc生效,再设置PS1变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span><span class="token string">"en_US.utf8"</span>

<span class="token comment"># 设置完编码后这里先退出保存一次,先让编码生效, 然后再打开编辑</span>
<span class="token builtin class-name">source</span> /root/.bashrc

<span class="token comment"># 设置PS1变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">"\[<span class="token entity" title="\033">\033</span>]0;Docker<span class="token entity" title="\007">\007</span>\]<span class="token entity" title="\n">\n</span>\[<span class="token entity" title="\033">\033</span>[32;1m\] ➜ \[<span class="token entity" title="\033">\033</span>[33;1m\]\W\[<span class="token entity" title="\033">\033</span>[34;1m\] [<span class="token entity" title="\t">\t</span>]\[<span class="token entity" title="\033">\033</span>[31m\]\[<span class="token entity" title="\033">\033</span>[36m\] "</span>

<span class="token comment"># 保存退出</span>
<span class="token builtin class-name">source</span> /root/.bashrc

<span class="token comment"># 新框架资产中心需要用到GRPC, Docker环境下安装GRPC</span>

<span class="token comment"># 查看版本</span>
pecl version 

<span class="token comment">#如果没有安装 pecl</span>

<span class="token comment"># php版本 > 7</span>
<span class="token function">wget</span> http://pear.php.net/go-pear.phar
php go-pear.phar

<span class="token comment"># php版本 &lt; 7</span>
yum <span class="token function">install</span> php-pear
<span class="token comment">#否则会报错PHP Parse error:  syntax error, unexpected //'new' (T_NEW) in /usr/share/pear/PEAR/Frontend.php on //line 91</span>

<span class="token comment"># 安装 grpc</span>
pecl <span class="token function">install</span> grpc

<span class="token comment"># 因为pecl没有加入PATH变量, 如果默认pecl PHP版本小于7.0 则可以使用一下路径方式或者把/usr/local/php/bin/加入PATH变量</span>
/usr/local/php/bin/pecl <span class="token function">install</span> protobuf
/usr/local/php/bin/pecl <span class="token function">install</span> grpc
/usr/local/php/bin/pecl <span class="token function">install</span> apcu

<span class="token comment"># GCC版本4.8编译报错, 升级版本到gcc 7.3</span>
yum -y <span class="token function">install</span> centos-release-scl
yum -y <span class="token function">install</span> devtoolset-7-gcc devtoolset-7-gcc-c++ devtoolset-7-binutils
scl <span class="token builtin class-name">enable</span> devtoolset-7 <span class="token function">bash</span>

<span class="token builtin class-name">echo</span> <span class="token string">"source /opt/rh/devtoolset-7/enable"</span> <span class="token operator">>></span>/etc/profile

<span class="token comment"># ssh证书问题 如果没有openssl文件夹先创建</span>
<span class="token function">wget</span> http://curl.haxx.se/ca/cacert.pem <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> cacert.pem /usr/local/openssl/cert.pem

<span class="token comment"># 写入配置</span>
<span class="token builtin class-name">echo</span> <span class="token string">"extension=grpc.so"</span> <span class="token operator">>></span> /usr/local/php/etc/php.ini
<span class="token builtin class-name">echo</span> <span class="token string">"extension=protobuf.so"</span> <span class="token operator">>></span> /usr/local/php/etc/php.ini
<span class="token builtin class-name">echo</span> <span class="token string">"extension=apcu.so"</span> <span class="token operator">>></span> /usr/local/php/etc/php.ini

<span class="token comment">#重启Docker</span></code></pre>



<h3 id="Docker-启动报错"><a href="#Docker-启动报错" class="headerlink" title="Docker 启动报错"></a>Docker 启动报错</h3><pre class="language-bash" data-language="bash"><code class="language-bash">Docker.Core.Backend.BackendException:
Error response from daemon: <span class="token function">open</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>.<span class="token punctuation">\</span>pipe<span class="token punctuation">\</span>docker_engine_linux: The system cannot <span class="token function">find</span> the <span class="token function">file</span> specified.</code></pre>

<p><strong>在win10 管理员身份打开cmd命令行提示符执行:</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Net stop com.docker.service
Net start com.docker.service</code></pre>



<h3 id="以往安装时执行过的命令参考"><a href="#以往安装时执行过的命令参考" class="headerlink" title="以往安装时执行过的命令参考"></a>以往安装时执行过的命令参考</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>   vp
<span class="token number">2</span>   php -m
<span class="token number">3</span>   e
<span class="token number">4</span>   <span class="token builtin class-name">logout</span>
<span class="token number">5</span>   <span class="token builtin class-name">exit</span>
<span class="token number">6</span>   <span class="token builtin class-name">exit</span>
<span class="token number">7</span>   yum -y <span class="token function">install</span> <span class="token function">vim</span>
<span class="token number">8</span>   <span class="token function">vim</span> /root/.bashrc
<span class="token number">9</span>   <span class="token builtin class-name">source</span> /root/.bashrc
<span class="token number">10</span>  <span class="token function">vim</span> /root/.bashrc
<span class="token number">11</span>  <span class="token builtin class-name">source</span> /root/.bashrc
<span class="token number">12</span>  pecl version 
<span class="token number">13</span>  <span class="token function">wget</span> http://pear.php.net/go-pear.phar
<span class="token number">14</span>  php go-pear.phar
<span class="token number">15</span>  <span class="token function">wget</span> http://pear.php.net/go-pear.phar
<span class="token number">16</span>  php go-pear.phar
<span class="token number">17</span>  yum <span class="token function">install</span> php-pear
<span class="token number">18</span>  pecl <span class="token function">install</span> grpc
<span class="token number">19</span>  /usr/local/php/bin/pecl <span class="token function">install</span> protobuf
<span class="token number">20</span>  /usr/local/php/bin/pecl <span class="token function">install</span> protobuf
<span class="token number">21</span>  /usr/local/php/bin/pecl <span class="token function">install</span> grpc
<span class="token number">22</span>  yum <span class="token function">install</span> php70w-devel
<span class="token number">23</span>  /usr/bin/phpize
<span class="token number">24</span>  <span class="token function">which</span> phpize
<span class="token number">25</span>  /usr/bin/phpize
<span class="token number">26</span>  yum <span class="token function">install</span> php-devel 
<span class="token number">27</span>  php -v
<span class="token number">28</span>  yum <span class="token function">install</span> php70w-devel 
<span class="token number">29</span>  /usr/bin/phpize
<span class="token number">30</span>  <span class="token function">which</span> php
<span class="token number">31</span>  <span class="token builtin class-name">cd</span> /usr/local/bin/php
<span class="token number">32</span>  <span class="token builtin class-name">pwd</span>
<span class="token number">33</span>  ll
<span class="token number">34</span>  /usr/local/php/bin/pecl <span class="token function">install</span> protobuf
<span class="token number">35</span>  /usr/local/php/bin/pecl <span class="token function">install</span> grpc
<span class="token number">36</span>  gcc --version
<span class="token number">37</span>  g++ --version
<span class="token number">38</span>  yum -y <span class="token function">install</span> centos-release-scl
<span class="token number">39</span>  yum -y <span class="token function">install</span> devtoolset-6-gcc devtoolset-6-gcc-c++ devtoolset-6-binutils
<span class="token number">40</span>  scl <span class="token builtin class-name">enable</span> devtoolset-6 <span class="token function">bash</span>
<span class="token number">41</span>  yum <span class="token function">install</span> centos-release-scl scl-utils-build
<span class="token number">42</span>  yum list all --enablerepo<span class="token operator">=</span><span class="token string">'centos-sclo-rh'</span>
<span class="token number">43</span>  yum <span class="token function">install</span> devtoolset-4-gcc.x86_64 devtoolset-4-gcc-c++.x86_64 devtoolset-4-gcc-gdb-plugin.x86_64 
<span class="token number">44</span>  scl --list 或 scl -l
<span class="token number">45</span>  scl --list
<span class="token number">46</span>  gcc -v
<span class="token number">47</span>  php -m
<span class="token number">48</span>  e
<span class="token number">49</span>  /usr/local/php/bin/pecl <span class="token function">install</span> protobuf
<span class="token number">50</span>  /usr/local/php/bin/pecl channel-update pecl.php.net
<span class="token number">51</span>  /usr/local/php/bin/pecl <span class="token function">install</span> protobuf
<span class="token number">52</span>  e
<span class="token number">53</span>  pecl version 
<span class="token number">54</span>  <span class="token function">wget</span> http://pear.php.net/go-pear.phar
<span class="token number">55</span>  php go-pear.phar
<span class="token number">56</span>  <span class="token function">vim</span> /etc/profile
<span class="token number">57</span>  <span class="token function">vim</span> ~/.bashrc 
<span class="token number">58</span>  <span class="token function">vim</span> ~/.bashrc 
<span class="token number">59</span>  <span class="token builtin class-name">source</span> ~/.bashrc
<span class="token number">60</span>  gcc --version
<span class="token number">61</span>  g++ --version
<span class="token number">62</span>  /usr/local/php/bin/pecl <span class="token function">install</span> protobuf
<span class="token number">63</span>  <span class="token function">wget</span> http://curl.haxx.se/ca/cacert.pem <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> cacert.pem /usr/local/openssl/cert.pem
<span class="token number">64</span>  ll
<span class="token number">65</span>  /usr/local/php/bin/pecl <span class="token function">install</span> protobuf
<span class="token number">66</span>  /usr/local/php/bin/pecl <span class="token function">install</span> grpc
<span class="token number">67</span>  /usr/local/php/bin/pecl <span class="token function">install</span> grpc
<span class="token number">68</span>  /usr/local/php/bin/pecl <span class="token function">install</span> apcu
<span class="token number">69</span>  /usr/local/php/bin/pecl <span class="token function">install</span> apcu
<span class="token number">70</span>  <span class="token function">wget</span> http://curl.haxx.se/ca/cacert.pem <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> cacert.pem /usr/local/openssl/cert.pem
<span class="token number">71</span>  ll
<span class="token number">72</span>  <span class="token builtin class-name">cd</span> /usr/local/openssl
<span class="token number">73</span>  <span class="token builtin class-name">cd</span> /usr/local/
<span class="token number">74</span>  <span class="token function">mkdir</span> openssl
<span class="token number">75</span>  <span class="token builtin class-name">cd</span> -
<span class="token number">76</span>  <span class="token function">mv</span> cacert.pem /usr/local/openssl/cert.pem
<span class="token number">77</span>  /usr/local/php/bin/pecl <span class="token function">install</span> apcu
<span class="token number">78</span>  <span class="token function">vim</span> /usr/local/php/etc/php.ini
<span class="token number">79</span>  e
<span class="token number">80</span>  pecl <span class="token function">install</span> grpc
<span class="token number">81</span>  pecl channel-update pecl.php.net
<span class="token number">82</span>  pecl <span class="token function">install</span> grpc
<span class="token number">83</span>  yum -y <span class="token function">install</span> centos-release-scl
<span class="token number">84</span>  yum -y <span class="token function">install</span> devtoolset-7-gcc devtoolset-7-gcc-c++ devtoolset-7-binutils
<span class="token number">85</span>  scl <span class="token builtin class-name">enable</span> devtoolset-7 <span class="token function">bash</span>
<span class="token number">86</span>  e
<span class="token number">87</span>  www
<span class="token number">88</span>  php tinyBell.php
<span class="token number">89</span>  php tinyBell.php start
<span class="token number">90</span>  php tinyBell.php start
<span class="token number">91</span>  <span class="token builtin class-name">pwd</span>
<span class="token number">92</span>  e</code></pre>


        </div>

        <blockquote class="post-copyright" style="display:none">
    
    <footer>
        <a href="http://chuchu-z.com">
            <img src="https://avatars.githubusercontent.com/u/33407400?s=400&u=a9cabf4402e2e3a38e67aa43da21164bbdd22f00&v=4" alt="chuchu-z">
            chuchu-z
        </a>
    </footer>
</blockquote>

        


        
            

            

        
    </div>

    
<nav class="post-nav flex-row flex-justify-between" style="display:none">
  
    <div class="waves-block waves-effect prev">
      <a href="/posts/windows10-git-bash/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Win10 自定义 Git-Bash 终端界面 + 一言与终端结合</h4>
      </a>
    </div>
  

  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            <span>chuchu-z &copy; 2021 - 2023</span>
            <span class="num">Total words: 9.1k</span>
        </p>
        <p><span>This blog is <a rel="help noopener" target="_blank" href="https://github.com/chuchu-z/chuchu-z.github.io/tree/src">open-source</a> and licensed under <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</span></p>
    </div>
    <div class="bottom">
        <p>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: false };


</script>

<script src="/js/main.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.js?v=1.7.2" async></script>










</body>
</html>
